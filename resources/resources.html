<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Microsoft Analytics tag to track analytics  -->
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "tp6dow982y");
    </script>

    <!-- Google tag to track analytics (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-N97Z02BGG4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-N97Z02BGG4');
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kahani Korner — Resources</title>
    <link rel="icon" type="image/png" href="/favicon.png" />

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Grandstander:wght@700;800&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    >

    <!-- Optional shared CSS if you're using it elsewhere -->
    <link rel="stylesheet" href="../quicklinks/SharedCSS/common.css">

    <style>
      /* --- THEME VARIABLES (same as landing / product) --- */
      :root {
        --granite: #4A594A;
        --deep-teal: #687D70;
        --ash-grey: #B0C3B7;
        --white-smoke: #F3F1F0;
        --soft-blush: #F3DEDD;
        --cotton-rose: #FFC4C3;
        --rosy-taupe: #D49797;
        --black: #1c2524;
        --white: #ffffff;

        --green: #B0C3B7;
        --mint: #C9DCCE;
        --radius-lg: 24px;
        --radius-md: 16px;
        --radius-pill: 999px;

        --shadow-soft: 0 18px 40px rgba(74, 89, 74, 0.15);
        --shadow-hover: 0 22px 50px rgba(74, 89, 74, 0.25);

        --card-bg: #ffffff;
        --danger: #ef4444;
        --muted: #5c6b68;
      }

      /* --- RESET & BASE --- */
      *, *::before, *::after { box-sizing: border-box; }

      html, body {
        width: 100%;
      }

      body {
        margin: 0;
        font-family: "Open Sans", system-ui, sans-serif;
        color: var(--granite);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        background: var(--white-smoke);

        /* OVERRIDE any "hidden until loaded" styles from common.css */
        opacity: 1 !important;
        visibility: visible !important;
      }

      img { max-width: 100%; display: block; }
      a { color: inherit; text-decoration: none; }
      button { font-family: inherit; cursor: pointer; }

      h1, h2, h3, h4 {
        font-family: "Grandstander", cursive;
        font-weight: 800;
        line-height: 1.2;
        margin: 0 0 1rem;
        color: var(--granite);
        text-shadow: none;
      }

      .hidden { display: none !important; }

      /* --- TOP PROMO BAR (same as landing / product) --- */
      .topbar {
        background: var(--green);
        color: #ffffff;
        font-size: 13px;
        font-weight: 600;
        overflow: hidden;
        white-space: nowrap;
      }

      .topbar__inner {
        display: flex;
        align-items: center;
        width: 100%;
      }

      .topbar__track {
        display: inline-block;
        padding-left: 100%;
        animation: marquee 22s linear infinite;
      }

      .topbar__track span {
        display: inline-block;
        padding-right: 50px;
        opacity: 0.9;
      }

      @keyframes marquee {
        0%   { transform: translateX(0); }
        100% { transform: translateX(-50%); }
      }

      /* --- HEADER / NAV (match landing) --- */
      .header {
        position: fixed;
        top: 1.75rem;
        left: 0;
        right: 0;
        z-index: 100;
        margin: 0.5rem 0.5rem;
        padding: 0.5rem 2rem;
        background: rgba(255, 255, 255, 0.55);
        backdrop-filter: blur(10px);
        border: 2px solid rgba(176, 195, 183, 0.7);
        border-radius: 999px;
        box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
        transition: background 0.25s ease,
                    border-color 0.25s ease,
                    box-shadow 0.25s ease;
      }

      .header__inner {
        display: flex;
        align-items: center;
        justify-content: space-between;
        width: 100%;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 12px;
        font-family: "Grandstander", cursive;
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--granite);
      }

      .brand-icon {
        font-size: 1.8rem;
        color: var(--rosy-taupe);
      }
.nav {
      display: flex;
      align-items: center;
      gap: 40px;
      font-weight: 300;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .nav a:hover {
      color: var(--soft-blush);
      font-weight: 700;
      transform: scale(1.05);
      text-shadow:
        -1px -1px 0 var(--granite),
         1px -1px 0 var(--granite),
        -1px  1px 0 var(--granite),
         1px  1px 0 var(--granite);
    }

      .mobile-toggle {
        display: none;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--granite);
      }

      /* --- MOBILE MENU (same pattern as landing) --- */
      .mobile-menu-overlay {
        position: fixed;
        inset: 0;
        background: rgba(28, 37, 36, 0.35);
        backdrop-filter: blur(4px);
        z-index: 120;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease;
      }

      .mobile-menu-overlay.open {
        opacity: 1;
        pointer-events: auto;
      }

      .mobile-menu {
        position: absolute;
        top: 0;
        right: 0;
        width: 80%;
        max-width: 320px;
        height: 100%;
        background: var(--white);
        border-left: 2px solid var(--ash-grey);
        box-shadow: -4px 0 30px rgba(0, 0, 0, 0.18);
        border-radius: 24px 0 0 24px;
        padding: 1.75rem 1.5rem 2rem;
        display: flex;
        flex-direction: column;
        transform: translateX(100%);
        transition: transform 0.35s cubic-bezier(0.22, 0.61, 0.36, 1);
      }

      .mobile-menu-overlay.open .mobile-menu {
        transform: translateX(0);
      }

      .mobile-menu__header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.25rem;
      }

      .mobile-menu__brand {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-family: "Grandstander", cursive;
        font-weight: 800;
        color: var(--granite);
      }

      .mobile-menu__brand i {
        color: var(--rosy-taupe);
      }

      .mobile-menu__close {
        background: var(--soft-blush);
        border: 2px solid var(--granite);
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        color: var(--granite);
        cursor: pointer;
        transition: background 0.2s ease, transform 0.1s ease;
      }

      .mobile-menu__close:hover {
        background: var(--cotton-rose);
        transform: translateY(-1px);
      }

      .mobile-menu__links {
        list-style: none;
        padding: 0;
        margin: 0;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .mobile-menu__links li a {
        display: block;
        padding: 0.75rem 0.25rem;
        font-size: 0.95rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        font-weight: 600;
        color: var(--granite);
        border-bottom: 1px dashed var(--white-smoke);
        transition: color 0.2s ease, transform 0.1s ease;
      }

      .mobile-menu__links li:last-child a {
        border-bottom: none;
      }

      .mobile-menu__links li a:hover {
        color: var(--cotton-rose);
        transform: translateX(3px);
      }

      @media (min-width: 769px) {
        .mobile-menu-overlay { display: none; }
      }

      /* --- CART BUTTON / OVERLAY (same as landing) --- */
      .cart-btn-landing {
        background: var(--mint);
        border: 2px solid var(--granite);
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--granite);
        transition: transform 0.2s, box-shadow 0.2s, background 0.2s;
        cursor: pointer;
        font-size: 1rem;
      }

      .cart-btn-landing:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 0 var(--granite);
        background: var(--ash-grey);
      }

      .cart-btn-landing:active {
        transform: translateY(0);
        box-shadow: 0 0 0 var(--granite);
      }

      .cart-badge-landing {
        position: absolute;
        top: -0.25rem;
        right: -0.25rem;
        background: var(--rosy-taupe);
        color: white;
        font-size: 0.75rem;
        font-weight: 800;
        min-width: 1.5rem;
        height: 1.5rem;
        border-radius: 9999px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid var(--white-smoke);
      }

      .cart-overlay {
        position: fixed;
        inset: 0;
        background: rgba(74, 89, 74, 0.2);
        z-index: 100;
        opacity: 0;
        transition: opacity 0.3s ease;
        backdrop-filter: blur(4px);
      }
      .cart-overlay.open { opacity: 1; }

      .cart-sidebar {
        position: absolute;
        top: 1rem;
        right: 1rem;
        bottom: 1rem;
        width: calc(100% - 2rem);
        max-width: 400px;
        background: var(--card-bg);
        border-radius: 1.5rem;
        box-shadow: 0 0 0 4px var(--ash-grey);
        transform: translateX(110%);
        transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      .cart-overlay.open .cart-sidebar {
        transform: translateX(0);
      }
      .cart-header {
        padding: 1.5rem;
        border-bottom: 2px dashed var(--ash-grey);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--white-smoke);
      }
      .close-btn {
        background: var(--soft-blush);
        border: none;
        font-size: 1.25rem;
        color: var(--granite);
        padding: 0.5rem;
        border-radius: 50%;
        width: 2.5rem;
        height: 2.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
      }
      .close-btn:hover {
        background: var(--cotton-rose);
      }
      .cart-items {
        flex: 1;
        overflow-y: auto;
        padding: 1.5rem;
      }
      .cart-item {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        background: var(--white-smoke);
        padding: 1rem;
        border-radius: 1rem;
      }
      .cart-item img {
        width: 4rem;
        height: 4rem;
        border-radius: 0.75rem;
        object-fit: cover;
        background: white;
      }
      .cart-item-details { flex: 1; }
      .cart-item-details h4 {
        font-size: 1rem;
        margin-bottom: 0.25rem;
      }
      .cart-item-price {
        font-weight: 700;
        color: var(--rosy-taupe);
        margin-bottom: 0.5rem;
      }
      .cart-controls {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .qty-btn {
        width: 1.75rem;
        height: 1.75rem;
        border: 2px solid var(--ash-grey);
        background: white;
        border-radius: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: var(--granite);
      }
      .qty-btn:hover {
        border-color: var(--deep-teal);
        color: var(--deep-teal);
      }
      .remove-btn {
        margin-left: auto;
        background: none;
        border: none;
        color: var(--danger);
        font-size: 0.75rem;
        font-weight: 600;
        cursor: pointer;
      }
      .cart-footer {
        padding: 1.5rem;
        border-top: 2px dashed var(--ash-grey);
        background: var(--white-smoke);
      }
      .cart-total {
        display: flex;
        justify-content: space-between;
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--granite);
        margin-bottom: 1rem;
      }
      .checkout-btn {
        width: 100%;
        padding: 1.25rem;
        background: var(--granite);
        color: white;
        border: none;
        border-radius: 1rem;
        font-size: 1.125rem;
        font-weight: 700;
        transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 4px 0 var(--deep-teal);
      }
      .checkout-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 0 var(--deep-teal);
      }
      .checkout-btn:active {
        transform: translateY(0);
        box-shadow: 0 0 0 var(--deep-teal);
      }
      .empty-cart-msg {
        text-align: center;
        color: var(--deep-teal);
        margin-top: 2rem;
        font-style: italic;
      }

      /* --- LAYOUT SPACER & MAIN SHELL --- */
      .header-spacer {
        height: 120px;
      }

      .page-main {
        max-width: 1100px;
        margin: 0 auto;
      }

      /* 1️⃣ Same padding idea as landing page */
      .section,
      .page-main {
        padding: 4rem 2rem;
      }

      /* --- RESOURCES CARD (card with border + rounded corners) --- */
      .resources-card {
        background: var(--card-bg);
        border: 1px solid var(--ash-grey);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-soft);
        padding: 3rem 2.5rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
      }

      .resources-card h1 {
        font-size: clamp(1.9rem, 3vw, 2.4rem);
        margin-bottom: 1rem;
      }

      .resources-subheading {
        max-width: 720px;
        margin: 0 auto 2rem;
        color: var(--muted);
        line-height: 1.7;
      }

      .resource-grid {
        display: flex;
        flex-direction: column;
        gap: 1.25rem;
        width: 100%;
        max-width: 400px;
      }

      .resource-link {
        width: 100%;
        background: var(--white-smoke);
        border: 2px solid var(--ash-grey);
        border-radius: var(--radius-lg);
        padding: 1.25rem 1.5rem;
        font-weight: 600;
        font-size: 0.95rem;
        text-transform: uppercase;
        text-align: center;
        box-shadow: var(--shadow-soft);
        transition: transform 0.3s ease, background 0.3s ease,
                    box-shadow 0.3s ease, border-color 0.3s ease;
      }

      .resource-link:hover {
        transform: translateY(-4px) scale(1.03);
        background: var(--mint);
        box-shadow: var(--shadow-hover);
        border-color: var(--rosy-taupe);
      }

      /* --- FOOTER --- */
      .footer {
        width: 100%;
        background: var(--granite);
        color: var(--ash-grey);
        padding: 4rem 2rem;
        text-align: center;
      }

      .footer-tagline {
        margin: 0 0 1rem;
        font-size: 0.95rem;
        color: var(--white-smoke);
      }

      .footer a {
        color: var(--white);
        font-weight: 700;
      }

      .footer-links {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin: 1.5rem 0;
        flex-wrap: wrap;
      }

      .social-icons {
        display: flex;
        justify-content: center;
        gap: 1.25rem;
        margin-top: 0.5rem;
        margin-bottom: 1.5rem;
      }

      .social-icons img {
        width: 26px;
        height: 26px;
        filter: invert(1);
        opacity: 0.85;
        transition: opacity 0.2s ease, transform 0.2s ease;
      }

      .social-icons a:hover img {
        opacity: 1;
        transform: translateY(-2px);
      }

      /* Responsive tweaks (aligned with landing) */
      @media (max-width: 768px) {
        .nav { display: none; }
        .mobile-toggle { display: block; }

        .page-main {
          padding: 3rem 1.25rem;
        }

        .resources-card {
          padding: 2.25rem 1.5rem 2.75rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Top Promo Bar -->
    <div class="topbar">
      <div class="topbar__inner">
        <div class="topbar__track">
          <span>Pre-Order Books Now</span>
          <span>•</span>
          <span>Free Shipping on All US Orders</span>
          <span>•</span>
          <span>Pre-Order Books Now</span>
          <span>•</span>
          <span>Free Shipping on All US Orders</span>
          <span>•</span>
          <span>Pre-Order Books Now</span>
          <span>•</span>
          <span>Free Shipping on All US Orders</span>
          <span>•</span>
        </div>
      </div>
    </div>

    <!-- Header / Nav -->
    <header class="header">
      <div class="header__inner">
        <!-- From quicklinks, go up one level to landing -->
        <a href="../index.html" class="brand">
          <i class="fa-solid fa-book-open-reader brand-icon"></i>
          Kahani Korner
        </a>

         <nav class="nav">
        <a href="products.html">Shop</a>
        <a href="subscribe.html">Subscribe</a>
        <a href="/resources/resources.html">Resources</a>
        <a href=index.html>Help</a>
        <a href="index.html">Contact</a>
      </nav>

        <button class="mobile-toggle" id="mobile-toggle" aria-label="Open menu">
          <i class="fa-solid fa-bars"></i>
        </button>
      </div>
    </header>

    <!-- Cart Overlay -->
    <div id="cart-overlay" class="cart-overlay hidden">
      <div class="cart-sidebar">
        <div class="cart-header">
          <h2>Your Cart</h2>
          <button id="close-cart" class="close-btn" aria-label="Close cart">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>
        <div id="cart-items" class="cart-items">
          <div class="empty-cart-msg">Your cart is empty.</div>
        </div>
        <div class="cart-footer">
          <div class="cart-total">
            <span>Total</span>
            <span id="cart-total-amount">$0.00</span>
          </div>
          <button id="checkout-btn" class="checkout-btn">Checkout</button>
        </div>
      </div>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu-overlay" class="mobile-menu-overlay hidden">
      <nav class="mobile-menu">
        <div class="mobile-menu__header">
          <span class="mobile-menu__brand">
            <i class="fa-solid fa-book-open-reader"></i>
            Kahani Korner
          </span>
          <button class="mobile-menu__close" aria-label="Close menu">
            <i class="fa-solid fa-xmark"></i>
          </button>
        </div>

        <ul class="mobile-menu__links">
          <li><a href="kahani-bundle.html">Shop</a></li>
          <li><a href="subscribe.html">Subscribe</a></li>
          <li><a href="resources.html">Resources</a></li>
          <li><a href="../landing.html#faq">Help</a></li>
          <li><a href="../landing.html#contact">Contact</a></li>
        </ul>
      </nav>
    </div>

    <!-- Spacer so content clears fixed header -->
    <div class="header-spacer" aria-hidden="true"></div>

    <!-- RESOURCES CONTENT -->
    <main class="page-main">
      <section class="resources-card" aria-labelledby="resources-heading">
        <h1 id="resources-heading">Resources</h1>

        <p class="resources-subheading">
          Click below to explore free resources that make teaching Urdu at home fun and meaningful.
          These tools are designed to spark curiosity, build connection, and bring the richness of
          Urdu language and culture into your daily routine. Enjoy these resources from Kahani Korner!
        </p>

        <div class="resource-grid">
          <a class="resource-link" href="parentguide.html">
            Teach Urdu at Home – Mini Guide
          </a>

          <a class="resource-link" href="teachers.html">
            Teacher Videos
          </a>

          <a class="resource-link" href="vlogs.html">
            Vlogs
          </a>

          <a class="resource-link" href="songs.html">
            Songs
          </a>

          <a class="resource-link" href="cartoons.html">
            Cartoons
          </a>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="brand" style="justify-content: center; color: var(--white); margin-bottom: 1rem;">
        <i class="fa-solid fa-book-open-reader"></i> Kahani Korner
      </div>

      <p class="footer-tagline">
        Rooted in culture, topped with sweetness, made for little hearts.
      </p>

      <div class="footer-links">
        <a href="kahani-bundle.html">Shop</a>
        <a href="subscribe.html">Subscribe</a>
        <a href="../landing.html#contact">Contact</a>
      </div>

      <div class="social-icons">
        <a
          href="https://www.instagram.com/kahani.korner/"
          target="_blank"
          aria-label="Instagram">
          <img
            src="https://img.icons8.com/ios-filled/50/000000/instagram-new.png"
            alt="Instagram" />
        </a>
        <a
          href="https://facebook.com/kahanikorner"
          target="_blank"
          aria-label="Facebook">
          <img
            src="https://img.icons8.com/ios-filled/50/000000/facebook-new.png"
            alt="Facebook" />
        </a>
        <a
          href="https://tiktok.com/@kahanikorner"
          target="_blank"
          aria-label="TikTok">
          <img
            src="https://img.icons8.com/ios-filled/50/000000/tiktok.png"
            alt="TikTok" />
        </a>
      </div>

      <p>&copy; 2025 Kahani Korner. All rights reserved.</p>
    </footer>

    <script>
      // --- STRIPE PAYLOAD (same as landing) ---
      function buildStripePayload(cartItems) {
        const line_items = cartItems.map(item => {
          return {
            price: item.id,
            quantity: item.quantity,
          };
        });
        return { line_items: line_items };
      }

      // --- PRODUCT DATA ---
      const products = [
        {
          id: "price_1SYLwPP4FFhr5UNAc6JmV0iR",
          name: "The Kahani Times Subscription (USA)",
          price: 55.0,
          image: "../assets/TheKahaniTimes.png"
        },
        {
          id: "price_1SJFOHP4FFhr5UNAShdcDISg",
          name: "The Kahani Times Subscription (USA)",
          price: 8.99,
          image: "../assets/TheKahaniTimes.png"
        },
        {
          id: "price_1SHXL0P4FFhr5UNA8oB0SpsX",
          name: "The Kahani Times Subscription (USA)",
          price: 129.0,
          image: "../assets/TheKahaniTimes.png"
        }
      ];

      // --- STATE ---
      let cart = [];

      // --- DOM ELEMENTS ---
      const cartBtn = document.getElementById("cart-btn");
      const closeCartBtn = document.getElementById("close-cart");
      const cartOverlay = document.getElementById("cart-overlay");
      const cartItemsContainer = document.getElementById("cart-items");
      const cartTotalAmount = document.getElementById("cart-total-amount");
      const cartBadge = document.getElementById("cart-badge");
      const checkoutBtn = document.getElementById("checkout-btn");
      const mobileToggle = document.getElementById("mobile-toggle");
      const mobileMenuOverlay = document.getElementById("mobile-menu-overlay");

      function init() {
        updateCartUI();

        if (cartBtn) cartBtn.addEventListener("click", openCart);
        if (closeCartBtn) closeCartBtn.addEventListener("click", closeCart);
        if (cartOverlay) {
          cartOverlay.addEventListener("click", (e) => {
            if (e.target === cartOverlay) closeCart();
          });
        }
        if (checkoutBtn) checkoutBtn.addEventListener("click", handleCheckout);

        // Mobile menu
        if (mobileToggle && mobileMenuOverlay) {
          mobileToggle.addEventListener("click", openMobileMenu);

          mobileMenuOverlay.addEventListener("click", (e) => {
            if (e.target === mobileMenuOverlay) closeMobileMenu();
          });

          const closeBtn = mobileMenuOverlay.querySelector(".mobile-menu__close");
          const menuLinks = mobileMenuOverlay.querySelectorAll(".mobile-menu__links a");

          if (closeBtn) {
            closeBtn.addEventListener("click", closeMobileMenu);
          }
          menuLinks.forEach((link) => {
            link.addEventListener("click", closeMobileMenu);
          });
        }
      }

      function updateCartUI() {
        if (!cartBadge) return;

        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        cartBadge.textContent = totalItems;

        if (totalItems === 0) {
          cartBadge.classList.add("hidden");
        } else {
          cartBadge.classList.remove("hidden");
        }

        if (cartTotalAmount) {
          const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
          cartTotalAmount.textContent = `$${total.toFixed(2)}`;
        }

        if (cartItemsContainer) {
          if (cart.length === 0) {
            cartItemsContainer.innerHTML = '<div class="empty-cart-msg">Your cart is empty.</div>';
          } else {
            cartItemsContainer.innerHTML = cart.map(item => `
              <div class="cart-item">
                <img src="${item.image}" alt="${item.name}">
                <div class="cart-item-details">
                  <h4>${item.name}</h4>
                  <div class="cart-item-price">$${(item.price * item.quantity).toFixed(2)}</div>
                  <div class="cart-controls">
                    <button class="qty-btn" onclick="updateQuantity('${item.id}', -1)">-</button>
                    <span>${item.quantity}</span>
                    <button class="qty-btn" onclick="updateQuantity('${item.id}', 1)">+</button>
                    <button class="remove-btn" onclick="removeFromCart('${item.id}')">Remove</button>
                  </div>
                </div>
              </div>
            `).join("");
          }
        }
      }

      window.updateQuantity = (productId, change) => {
        const item = cart.find((item) => item.id === productId);
        if (item) {
          item.quantity += change;
          if (item.quantity <= 0) {
            removeFromCart(productId);
          } else {
            updateCartUI();
          }
        }
      };

      window.removeFromCart = (productId) => {
        cart = cart.filter((item) => item.id !== productId);
        updateCartUI();
      };

      function openCart() {
        if (!cartOverlay) return;
        cartOverlay.classList.remove("hidden");
        setTimeout(() => cartOverlay.classList.add("open"), 10);
      }

      function closeCart() {
        if (!cartOverlay) return;
        cartOverlay.classList.remove("open");
        setTimeout(() => {
          cartOverlay.classList.add("hidden");
        }, 300);
      }

      async function handleCheckout() {
        if (cart.length === 0) return;

        const { line_items } = buildStripePayload(cart);
        const originalText = checkoutBtn.innerText;
        checkoutBtn.innerText = "Redirecting to Stripe...";
        checkoutBtn.disabled = true;

        try {
          const response = await fetch("/create-checkout-session", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ items: line_items }),
          });

          if (!response.ok) {
            alert("There was a problem starting checkout. Please try again.");
            checkoutBtn.innerText = originalText;
            checkoutBtn.disabled = false;
            return;
          }

          const data = await response.json();
          window.location.href = data.url;
        } catch (err) {
          console.error("Error:", err);
          alert("Unexpected error. Please try again.");
          checkoutBtn.innerText = originalText;
          checkoutBtn.disabled = false;
        }
      }

      function openMobileMenu() {
        if (!mobileMenuOverlay) return;
        mobileMenuOverlay.classList.remove("hidden");
        requestAnimationFrame(() => {
          mobileMenuOverlay.classList.add("open");
        });
      }

      function closeMobileMenu() {
        if (!mobileMenuOverlay) return;
        mobileMenuOverlay.classList.remove("open");
        setTimeout(() => {
          mobileMenuOverlay.classList.add("hidden");
        }, 300);
      }

      // Ensure both: CSS that wants .loaded AND our init() both run
      window.addEventListener("load", function () {
        document.body.classList.add("loaded");
        init();
      });
    </script>
  </body>
</html>
